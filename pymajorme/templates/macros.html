{% macro getAttributeName(attribute) %}
    {% if attribute.column_parameters|selectattr("name", "equalto", "name")|list|count > 0 -%}
    {#- uzima se poslednji name atribut, ako nije definisan uzima se naziv atributa za naziv kolone -#}
    name = "{{(attribute.column_parameters|selectattr("name", "equalto", "name")|list|last).value}}"
    {%- else -%}
    name = "{{attribute.name}}"
    {%- endif -%}
{% endmacro -%}

{% macro getAttributeNameForJoin(attribute) %}
    {% if attribute.join_column_parameters|selectattr("name", "equalto", "name")|list|count > 0 -%}
    {#- uzima se poslednji name atribut, ako nije definisan uzima se naziv atributa za naziv kolone -#}
    {{(attribute.join_column_parameters|selectattr("name", "equalto", "name")|list|last).value}}
    {%- elif attribute.name -%}
    {{attribute.name}}
    {%- else -%}
    {{attribute.type.name}}
    {%- endif -%}
{% endmacro -%}

{% macro relationAnnotations(sourceSide, destinationSide, relation_type, reverse) %}
    {% if destinationSide.fk_column_parameters %}(
    {%- for param in destinationSide.fk_column_parameters %}
    {%- if param.name == "cascade" -%}
    cascade = {
    {%- for cascade in param.values -%}
    {%- if not loop.first %}, {% endif %}{{cascade}}
    {%- endfor %}}
    {%- else %}
    {%- if not loop.first %}, {% endif %}{{param.name}} = {{param.value}}
    {%- endif %}
    {% endfor -%}

    , targetEntity = {{destinationSide.type.name}}.class

    {#- and reverse because one sided mappedBy is enough -#}
    {%- if not relation_type|relation_name(reverse) == 'ManyToOne' and reverse -%}
    , mappedBy = "{{ getAttributeNameForJoin(sourceSide)|decapitalize }}"
    {%- endif -%}

    {# Optional attribute based on minimal cardinality #}
    {% if relation_type|relation_name(reverse) == 'OneToOne' or relation_type|relation_name(reverse) == 'ManyToOne' %}

    {%- if relation_type.src_min_cardinality and reverse -%}
    , optional =
    {%- if relation_type.src_min_cardinality == '0' -%}
    {{ ' true' }}
    {%- elif relation_type.src_min_cardinality == '1' -%}
    {{ ' false' }}
    {%- endif %}
    {% endif %}

    {%- if relation_type.dst_min_cardinality and not reverse -%}
    , optional =
    {%- if relation_type.dst_min_cardinality == '0' -%}
    {{ ' true' }}
    {%- elif relation_type.dst_min_cardinality == '1' -%}
    {{ ' false' }}
    {%- endif %}
    {% endif %}
    {% endif %})


    {#- Optional attribute based on minimal cardinality if non of attributes are defined #}
    {%- elif relation_type|relation_name(reverse) == 'OneToOne' or relation_type|relation_name(reverse) == 'ManyToOne' -%}
    (targetEntity = {{destinationSide.type.name}}.class

    {#- and reverse because one sided mappedBy is enough -#}
    {%- if not relation_type|relation_name(reverse) == 'ManyToOne' and reverse -%}
    , mappedBy = "{{ getAttributeNameForJoin(sourceSide)|decapitalize }}"
    {%- endif -%}

    {%- if relation_type.src_min_cardinality and reverse -%}
    , optional =
    {%- if relation_type.src_min_cardinality == '0' -%}
    {{ ' true' }}
    {%- elif relation_type.src_min_cardinality == '1' -%}
    {{ ' false' }}
    {%- endif %})
    {%- endif %}

    {%- if relation_type.dst_min_cardinality and not reverse -%}
    , optional =
    {%- if relation_type.dst_min_cardinality == '0' -%}
    {{ ' true' }}
    {%- elif relation_type.dst_min_cardinality == '1' -%}
    {{ ' false' }}
    {%- endif %})
    {%- endif %}
    {% endif %}

    @JoinColumn(name = "{{getAttributeNameForJoin(destinationSide)}}"
    {%- if relation_type == 'ManyToOne' -%}
    , referencedColumnName = "
    {%- if sourceSide.join_column_atributes|selectattr("name", "equalto", "referencedColumnName")|list|count > 0 -%}
    {{- (sourceSide.join_column_atributes|selectattr("name", "equalto", "referencedColumnName")|list|first).value }}
    {%- else -%}
    id
    {%- endif %}"
    {%- endif -%}
    {%- if destinationSide.join_column_parameters %}
    {%- for param in destinationSide.join_column_parameters|rejectattr("name", "equalto", "name")|rejectattr("name", "equalto", "referencedColumnName") -%}
    , {{param.name}} = {{param.value}}
    {%- endfor %}
    {% endif -%})
{%- endmacro %}